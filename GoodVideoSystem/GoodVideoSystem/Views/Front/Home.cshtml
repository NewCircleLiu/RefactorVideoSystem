@{
    ViewBag.Title = "View1";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@using RefactorVideoSystem.Models.Models
@model RefactorVideoSystem.Models.Models.Code[]

<style>
    a:hover {
        text-decoration: none;
    }
</style>

@Html.Partial("HomePartialView")

<div class="gallery">
    <div class="container">
        <form class="form-inline" role="form" action="#">
            <div id="search_wrapper1" style="margin-top: 3em">
                <div id="search_form" class="clearfix">
                        <input type="text" class="text" id="videoCode" placeholder="输入邀请码" onfocus="clearInfo();" size="30">
                        <input onclick="getVideo();" class="getVideoButton" type="button" style="width:150px" value="获取视频" >
                        <p id="info" style="color:red;"></p>
                 </div>
            </div>
        </form>

        <hr style="border-bottom: 1px solid #f15f43;" />

        <div class="gallery-main" style="padding-left: 0; padding-right: 0">
            <div class="gallery-bottom">
                @if (Model.Length <= 0)
                {
                   <div style=" background-color: #ddd; font-family:'Microsoft yahei'; font-size: 1.2em; line-height:2; text-align: center; padding-top: 50px; padding-bottom: 50px">
                        视频库空空如也，赶紧在上方的文本框里输入你的邀请码吧！<br />
                       <span style="color:red">注意邀请码的长度为10位，并且区分大小写哦！</span> 
                        <br />安卓手机端请扫描下方二维码，下载并安装平安串珠APP。
                        <br /><img src="/Resources/img/appimg.png" width="200" />
                   </div>
                }
                else
                {
                    foreach (Code c in Model)
                    {
                        <div class="col-md-3"> 
                            <div class="view view-third" style="padding-left: 10px; padding-right: 10px; margin: 20px 0">
                                <a href="~/Home/PlayVideo?videoID=@c.VideoID" class="b-link-stripe b-animate-go  swipebox">
                                    @if (c.Video.VideoImageLocal == "null")
                                    {
                                        <img src="@Url.Content("~/Resources/img/qhpa.jpg")" alt="" class="img-responsive">
                                    }
                                    else
                                    {
                                        <img src="@c.Video.VideoImageLocal" alt="" class="img-responsive">
                                    }
                                    <!--
                                        <div class="mask" style="width:100%; height: 100%; background-image: url(/Image/video_image/play_icon.png); background-repeat: no-repeat; background-position: center center">
                                        </div>
                                    -->
                                    <h4 style="line-height:1.2; clear:both; overflow:visible;margin-top:8px; color:black; font-family:'Microsoft YaHei'">
                                        @{
                                            string name = c.Video.VideoName.Split('.')[0];
                                         }
                                        @name
                                    </h4>
                                </a>
                            </div>
                        </div>	
                    }
                }
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
<script>
    function getVideo() {
        var videoCode = jQuery("#videoCode");
        if (videoCode.val().length <= 0) {
            jQuery("#info").text("邀请码不能为空");
            return;
        }

        jQuery.post(
            "/Home/GetVideo",
            {
                "videoCode": videoCode.val()
            },
            function (data) {
                if (data == "invalid") {
                    jQuery("#info").text("此验证码无效");
                }
                else if (data == "outOfCount") {
                    jQuery("#info").text("此验证码已使用");
                }
                else if (data == "ok") {
                    location.reload();
                }
                else if (data == "error") {
                    jQuery("#info").text("视频获取失败");
                }
            }
        );
    }

    function clearInfo() {
        jQuery("#info").text("");
    }
</script>
